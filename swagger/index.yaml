swagger: "2.0"
info:
  title: hwp-manager
  description: hwp-manager test
  version: 0.0.1
#host: localhost:3002
schemes:
  - http
  - https

tags:
  - name: work
    description: 문제 처리 포맷입니다.

securityDefinitions:
  jwt:
    type: "basic"

  bearer:
    type: apiKey
    name: Authorization
    in: header

security:
  - jwt: []
  - bearer: []

paths:
  /question/hwpMetadataExtract:
    post:
      summary: "hwp 파일의 metadata를 추출합니다."
      description: "workGroupId : metadata를 분석할 파일들의 S3 Key의 prefix입니다.\n
      작업 중 동일 workGroupId로 요청 시 workGroupId가 return됩니다.\n
      작업 종료 후 동일 workGroupId로 요청 시 workGroupId가 return되며 message가 다시 AWS SNS로 notification됩니다.\n
      AWS SNS에 아래와 같은 형태로 notification됩니다.\n
      ```typescript
      message : {
        \tdata : Result[]
        \tworkKey : string
      }
      ```
      ```typescript
      Result : {
        \tbucket: string
        \tquestionKey : string
        \tanswerKey : string
        \tmetadata : Metadata

        \tquestionGroupKey? : string // 연속 문제 그룹의 key
        \twc? : WC // 공통지문을 제외한 문제 부분 (Without Common)

        \ttaskGroupId: string // S3에 업로드된 모든 파일들의 Key의 공통 Prefix
      }
      ```
      ```typescript
      Metadata : {
        \tpublisher: string | null (출제처, 출처)
        \ttag: string | null (태그)
        \tlevel: string | null (난이도)
        \tcategory: string | null (유형)
        \ttype: string | null (분류)
        \tapply: string | null (용도)
        \ttarget: string | null (과목)

        \tquestionFileMetadata: FileMetadata
        \tanswerFileMetadata: FileMetadata
      }
      ```
      ```typescript
      WC : {
        \tquestionKey: string
        \tquestionFileMetadata: FileMetadata
      }
      ```
      ```typescript
      FileMetadata : {
        \timageHeight: number
        \tthumbnailKey: string
        \textractedImageKey: string
        \ttext: string
        \tbucket: string
      }
      ```
      "

      tags:
        - work
      parameters:
        - name: body
          in: body
          required: true
          schema:
            properties:
              taskGroupId:
                type: string

      responses:
        200:
          description: "workKey를 내려줍니다."
          schema:
            properties:
              workKey:
                type: string
        400:
          description: "Bad Request : 요청이 잘못되었습니다."
        404:
          description: "Not Found : S3에 파일이 없습니다."
        500:
          description: "Unexpected Exception : 알 수 없는 에러입니다."

  /question/questionSplit:
    post:
      summary: "hwp 파일의 문제들을 split합니다."
      description: "questionFileKey: 문제 파일의 Key입니다.\nanswerFileKey: 정답 파일의 Key입니다.\n
      AWS SNS에 아래와 같은 형태로 notification됩니다.\n
      ```typescript
      message: {
        \tworkKey : string
        \tfileKeys : {
          \t\tquesitonKey: string, // s3경로 키 (파일이름포함)
          \t\tanswerKey: string, // s3경로 키 (파일이름포함)
          \t\tmetadataKey: string, // s3경로 키 (파일이름포함)
          \t\tquesitonWCKey: string // s3경로 키 (파일이름포함)
          \t\tbucket: string
          \t\ttaskGroupId: string,
        \t}
      }
      ```
      "
      tags:
        - work
      parameters:
        - name: body
          in: body
          required: true
          schema:
            properties:
              questionFileKey:
                type: string
              answerFileKey:
                type: string

      responses:
        200:
          description: "workKey를 내려줍니다."
          schema:
            properties:
              workKey:
                type: string
        400:
          description: "Bad Request : 요청이 잘못되었습니다."
        404:
          description: "Not Found : S3에 파일이 없습니다."
        500:
          description: "Unexpected Exception : 알 수 없는 에러입니다."

  /question/makePaper:
    post:
      summary: "문제 list를 시험지로 만듭니다."
      description: "questionFileKeys: 시험지로 만들 문제들의 Key의 list입니다.\ndynamicContents: 표지에 들어갈 내용입니다. data: 한글 누름틀 이름, string: 내용 입니다.\n"
      tags:
        - work
      parameters:
        - name: body
          in: body
          required: true
          schema:
            properties:
              questionFileKeys:
                type: array
                items:
                  type: string
              dynamicContents:
                type: object
                properties:
                  data:
                    type: string

      responses:
        200:
          description: "생성된 시험지의 Key를 내려줍니다."
          schema:
            properties:
              paperKey:
                type: string
        400:
          description: "Bad Request : 요청이 잘못되었습니다."
        404:
          description: "Not Found : S3에 파일이 없습니다."
        500:
          description: "Unexpected Exception : 알 수 없는 에러입니다."